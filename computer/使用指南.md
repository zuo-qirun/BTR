# 电池热失控预测系统 - 快速使用指南

## 📋 目录

1. [系统概述](#系统概述)
2. [快速开始](#快速开始)
3. [文件说明](#文件说明)
4. [使用流程](#使用流程)
5. [常见问题](#常见问题)

## 🔋 系统概述

本系统使用深度学习LSTM神经网络，基于温度时间序列数据实时预测电池热失控风险。

**核心功能：**
- ✅ 每0.5秒接收一个温度数据点
- ✅ 使用过去30秒（60个数据点）的温度历史
- ✅ 实时预测未来10秒内的热失控风险
- ✅ 多级风险评估（低、中、高、极高）
- ✅ 智能预警系统

## 🚀 快速开始

### 第一步：安装依赖

```bash
cd computer
pip install -r requirements.txt
```

### 第二步：运行快速开始脚本

```bash
python quick_start.py
```

这个脚本会：
1. ✓ 检查所有依赖是否安装
2. ✓ 检查数据文件是否存在
3. ✓ 检查模型是否已训练
4. ✓ 如果需要，自动训练模型
5. ✓ 运行演示程序

### 第三步：查看结果

训练完成后会生成：
- `models/thermal_runaway_model.h5` - 训练好的模型
- `models/scaler.pkl` - 数据标准化器
- `models/config.pkl` - 模型配置
- `models/training_history.png` - 训练过程可视化

## 📁 文件说明

### 核心脚本

| 文件 | 说明 | 用途 |
|------|------|------|
| `train_model.py` | 模型训练脚本 | 训练LSTM神经网络模型 |
| `predict_realtime.py` | 实时预测脚本 | 实时预测热失控风险 |
| `quick_start.py` | 快速开始脚本 | 一键检查环境并运行演示 |
| `analyze_data.py` | 数据分析脚本 | 分析数据质量和生成报告 |
| `examples.py` | 使用示例脚本 | 展示各种使用场景 |

### 数据文件

```
data/
├── temp_data_001.csv          # 正常数据
├── temp_data_002.csv          # 正常数据
├── ...
├── temp_data_036_exception.csv  # 异常数据（热失控）
├── temp_data_045_exception.csv  # 异常数据（热失控）
└── ...
```

**数据格式：**
```csv
Time,Temperature
0.0,31.03
0.5,31.05
1.0,31.08
...
```

## 📖 使用流程

### 方案A：完整训练流程

```bash
# 1. 分析数据（可选）
python analyze_data.py

# 2. 训练模型
python train_model.py

# 3. 测试预测
python predict_realtime.py
```

### 方案B：使用快速开始

```bash
# 一键完成所有步骤
python quick_start.py
```

### 方案C：查看使用示例

```bash
# 运行交互式示例
python examples.py
```

## 💻 代码集成示例

### 示例1：基本使用

```python
from predict_realtime import RealTimePredictor

# 初始化预测器
predictor = RealTimePredictor()

# 添加温度数据（需要至少60个数据点）
for temp in temperature_readings:
    predictor.add_temperature(temp)

# 进行预测
if predictor.can_predict():
    risk_prob, risk_level, warning = predictor.predict()
    print(f"热失控风险: {risk_prob:.2%} ({risk_level})")
    
    if warning:
        print("⚠️ 警告: 检测到热失控风险!")
```

### 示例2：实时监控循环

```python
import time
from predict_realtime import RealTimePredictor

predictor = RealTimePredictor()

while True:
    # 从传感器读取温度
    temperature = read_temperature_from_sensor()
    
    # 添加到预测器
    predictor.add_temperature(temperature)
    
    # 每秒预测一次
    if predictor.can_predict():
        risk_prob, risk_level, warning = predictor.predict()
        
        if warning:
            # 触发报警
            trigger_alarm()
            send_notification(f"热失控风险: {risk_prob:.2%}")
    
    # 等待0.5秒（采样间隔）
    time.sleep(0.5)
```

### 示例3：获取温度统计

```python
predictor = RealTimePredictor()

# 添加数据...
for temp in temperatures:
    predictor.add_temperature(temp)

# 获取统计信息
stats = predictor.get_temperature_stats()
print(f"当前温度: {stats['current']:.2f}°C")
print(f"平均温度: {stats['mean']:.2f}°C")
print(f"最高温度: {stats['max']:.2f}°C")
print(f"最低温度: {stats['min']:.2f}°C")
print(f"温度趋势: {stats['trend']:+.2f}°C")
```

## 🎯 风险等级说明

| 风险概率 | 风险等级 | 建议措施 |
|---------|---------|---------|
| 0-30% | 低 🟢 | 正常监控 |
| 30-60% | 中 🟡 | 加强监控 |
| 60-80% | 高 🟠 | 准备应急措施 |
| 80-100% | 极高 🔴 | 立即采取行动 |

## ⚙️ 配置参数

在 `train_model.py` 中可以调整以下参数：

```python
SEQUENCE_LENGTH = 60      # 时间序列长度（60个点 = 30秒）
PREDICTION_HORIZON = 20   # 预测未来时间步（20个点 = 10秒）
BATCH_SIZE = 32          # 训练批次大小
EPOCHS = 50              # 训练轮数
LEARNING_RATE = 0.001    # 学习率
```

**调整建议：**
- 如果数据采样频率不是0.5秒，需要调整 `SEQUENCE_LENGTH`
- 如果想预测更远的未来，增加 `PREDICTION_HORIZON`
- 如果训练太慢，减小 `BATCH_SIZE` 或 `EPOCHS`
- 如果模型不收敛，调整 `LEARNING_RATE`

## 📊 模型性能

训练完成后会显示：

```
测试集结果:
Loss: 0.1234
Accuracy: 0.9567
Precision: 0.9234
Recall: 0.9456

混淆矩阵:
[[TN  FP]
 [FN  TP]]
```

**指标说明：**
- **Accuracy（准确率）**: 整体预测正确的比例
- **Precision（精确率）**: 预测为热失控中真正热失控的比例
- **Recall（召回率）**: 实际热失控中被正确识别的比例

## ❓ 常见问题

### Q1: 提示"模型文件未找到"

**A:** 需要先训练模型：
```bash
python train_model.py
```

### Q2: 训练时内存不足

**A:** 减小批次大小：
```python
BATCH_SIZE = 16  # 或更小
```

### Q3: 预测准确率低

**A:** 尝试以下方法：
1. 增加训练数据量
2. 增加训练轮数 `EPOCHS = 100`
3. 调整序列长度 `SEQUENCE_LENGTH = 120`
4. 检查数据质量：`python analyze_data.py`

### Q4: 如何使用自己的数据？

**A:** 
1. 将CSV文件放入 `data/` 目录
2. 正常数据命名：`temp_data_XXX.csv`
3. 异常数据命名：`temp_data_XXX_exception.csv`
4. 确保CSV格式：`Time,Temperature`
5. 重新训练模型

### Q5: 如何调整预警阈值？

**A:** 在 `predict_realtime.py` 的 `predict()` 方法中修改：
```python
if risk_prob < 0.3:      # 调整这些阈值
    risk_level = "低"
elif risk_prob < 0.6:
    risk_level = "中"
elif risk_prob < 0.8:
    risk_level = "高"
else:
    risk_level = "极高"
```

### Q6: 可以预测多个温度传感器吗？

**A:** 当前版本支持单个温度序列。如果有多个传感器：
- 方案1：分别为每个传感器创建预测器实例
- 方案2：修改模型输入维度以支持多通道输入

### Q7: 如何导出预测结果？

**A:** 在预测循环中添加日志记录：
```python
import csv

with open('predictions.csv', 'w', newline='') as f:
    writer = csv.writer(f)
    writer.writerow(['Timestamp', 'Temperature', 'Risk', 'Level'])
    
    while True:
        # 预测...
        writer.writerow([timestamp, temp, risk_prob, risk_level])
```

## 📞 技术支持

如有问题或建议，请查看：
- 详细文档：`README_MODEL.md`
- 代码示例：`examples.py`
- 数据分析：`analyze_data.py`

## 📝 更新日志

**v1.0.0** (2026-02-09)
- ✅ 初始版本发布
- ✅ LSTM模型实现
- ✅ 实时预测功能
- ✅ 多级风险评估
- ✅ 完整文档和示例

---

**祝使用愉快！🎉**
